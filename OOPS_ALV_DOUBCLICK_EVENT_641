REPORT zalv_double_click_demo.

* Define types for output table (moved before class to ensure visibility)
TYPES: BEGIN OF ty_sflight,
         carrid   TYPE sflight-carrid,
         connid   TYPE sflight-connid,
         fldate   TYPE sflight-fldate,
         price    TYPE sflight-price,
         currency TYPE sflight-currency,
       END OF ty_sflight.

* Data declarations
DATA: gt_sflight   TYPE TABLE OF ty_sflight,
      go_alv       TYPE REF TO cl_gui_alv_grid,
      go_container TYPE REF TO cl_gui_custom_container.


* Local class for event handling
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    METHODS: on_double_click FOR EVENT double_click OF cl_gui_alv_grid
      IMPORTING e_row e_column es_row_no.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD on_double_click.
    DATA: ls_sflight TYPE ty_sflight.

    " Read the selected row using es_row_no-row_id
    READ TABLE gt_sflight INTO ls_sflight INDEX es_row_no-row_id.
    IF sy-subrc = 0.
      MESSAGE |Double-clicked on row { es_row_no-row_id }, column { e_column-fieldname }, Carrier: { ls_sflight-carrid }| TYPE 'I'.
    ELSE.
      MESSAGE 'No data found for the selected row.' TYPE 'I'.
    ENDIF.
  ENDMETHOD.
ENDCLASS.

* Main program flow
START-OF-SELECTION.
  PERFORM fetch_data.
  CALL SCREEN 100.  " Call custom screen with container

* PBO module for screen 100
MODULE status_0100 OUTPUT.
  SET PF-STATUS 'STATUS_100'.
  SET TITLEBAR 'TITLE_100'.

  IF go_container IS INITIAL.
    CREATE OBJECT go_container
      EXPORTING
        container_name = 'CONTAINER'.  " Custom container name on screen 100

    CREATE OBJECT go_alv
      EXPORTING
        i_parent = go_container.

    PERFORM display_alv.
  ENDIF.
ENDMODULE.

* PAI module for screen 100
MODULE user_command_0100 INPUT.
  CASE sy-ucomm.
    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
      LEAVE TO SCREEN 0.
  ENDCASE.
ENDMODULE.

* Form to fetch sample data
FORM fetch_data.
  SELECT carrid, connid, fldate, price, currency
    FROM sflight
    INTO TABLE @gt_sflight
    UP TO 10 ROWS.
ENDFORM.

* Form to set up and display ALV
FORM display_alv.
  DATA: lt_fieldcat TYPE lvc_t_fcat.
  DATA go_event_handler TYPE REF TO lcl_event_handler.

  " Build field catalog
  CALL FUNCTION 'LVC_FIELDCATALOG_MERGE'
    EXPORTING
      i_structure_name = 'SFLIGHT'
    CHANGING
      ct_fieldcat      = lt_fieldcat.

  " Display ALV
  CALL METHOD go_alv->set_table_for_first_display
    EXPORTING
      i_structure_name = 'SFLIGHT'
    CHANGING
      it_outtab        = gt_sflight
      it_fieldcatalog  = lt_fieldcat.

  " Register event handler
  CREATE OBJECT go_event_handler.
  SET HANDLER go_event_handler->on_double_click FOR go_alv.

  CALL METHOD cl_gui_cfw=>flush.
ENDFORM.
