*&---------------------------------------------------------------------*
*& Report ZPRO1_ALVOOPS_641
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT zpro7_alvoops_factorycon_641.

TABLES vbak.

TYPES : BEGIN OF ltvbak,
          vbeln TYPE vbeln_va,
          erdat TYPE erdat,
          erzet TYPE erzet,
          ernam TYPE ernam,
          vbtyp TYPE VBTYPl,
        END OF ltvbak.

TYPES : BEGIN OF ltvbap,
          vbeln TYPE vbeln_va,
          posnr TYPE posnr_va,
          matnr TYPE matnr,
        END OF ltvbap.

TYPES : BEGIN OF ltfinal,
          vbeln TYPE vbeln_va,
          erdat TYPE erdat,
          erzet TYPE erzet,
          ernam TYPE ernam,
          vbtyp TYPE VBTYPl,
          posnr TYPE posnr_va,
          matnr TYPE matnr,
        END OF ltfinal.

DATA itab_vbak TYPE TABLE OF ltvbak.
DATA wa_vbak TYPE  ltvbak.
DATA itab_vbap TYPE TABLE OF ltvbap.
DATA wa_vbap TYPE  ltvbap.
DATA itab_final TYPE TABLE OF ltfinal.
DATA wa_final TYPE ltfinal.
DATA itab_fieldcat TYPE lvc_t_fcat.
DATA wa_fieldcat TYPE lvc_s_fcat.
DATA lo_object TYPE REF TO cl_gui_custom_container.
DATA lo_grid TYPE REF TO cl_gui_alv_grid.
DATA lo_alv TYPE REF TO cl_salv_table.
DATA lo_cont TYPE REF TO cl_gui_custom_container.
DATA lo_fun TYPE REF TO cl_salv_functions_list.

SELECT-OPTIONS s_vbeln FOR vbak-vbeln.

SELECT vbeln erdat erzet ernam vbtyp
FROM  vbak
INTO TABLE itab_vbak
WHERE vbeln IN s_vbeln.

IF itab_vbak IS NOT INITIAL.
  SELECT vbeln posnr matnr
  FROM vbap
  INTO TABLE itab_vbap
  FOR ALL ENTRIES IN itab_vbak
  WHERE vbeln = itab_vbak-vbeln.
ENDIF.

LOOP AT itab_vbak INTO wa_vbak.
  LOOP AT itab_vbap INTO wa_vbap WHERE vbeln = wa_vbak-vbeln.
    wa_final-vbeln = wa_vbak-vbeln.
    wa_final-erdat = wa_vbak-erdat.
    wa_final-erzet = wa_vbak-erzet.
    wa_final-ernam = wa_vbak-ernam.
    wa_final-vbtyp = wa_vbak-vbtyp.
    wa_final-posnr = wa_vbap-posnr.
    wa_final-matnr = wa_vbap-matnr.
    APPEND wa_final TO itab_final.
    CLEAR wa_final.
  ENDLOOP.
ENDLOOP.

CREATE OBJECT lo_cont
  EXPORTING
    container_name = 'CONT'.



TRY.
    CALL METHOD cl_salv_table=>factory
      EXPORTING
*       list_display = IF_SALV_C_BOOL_SAP=>FALSE
        r_container  = lo_cont
*       container_name = 'CONT'
      IMPORTING
        r_salv_table = lo_alv
      CHANGING
        t_table      = itab_final.
  CATCH cx_salv_msg.
ENDTRY.


CALL METHOD lo_alv->if_salv_gui_om_table_action~display.

CALL SCREEN '0100'.

INCLUDE zpro7_alvoops_factorycon_64i01.
