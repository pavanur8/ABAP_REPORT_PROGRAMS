*&---------------------------------------------------------------------*
*& Report ZSMARTFORM_TO_PDF_641
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT zsmartform_to_pdf_641.
*

DATA lt_vbap TYPE ztt_vbap_641.
DATA ls_controll TYPE ssfctrlop.
ls_controll-getotf = 'X'.
DATA ls_job_output TYPE ssfcrescl.


PARAMETERS p_vbeln TYPE vbeln_va.

START-OF-SELECTION.

  SELECT vbeln posnr matnr
  FROM vbap
  INTO TABLE lt_vbap
  WHERE vbeln EQ p_vbeln.



  CALL FUNCTION '/1BCDWB/SF00000123'
    EXPORTING
*     ARCHIVE_INDEX      =
*     ARCHIVE_INDEX_TAB  =
*     ARCHIVE_PARAMETERS =
      control_parameters = ls_controll
*     MAIL_APPL_OBJ      =
*     MAIL_RECIPIENT     =
*     MAIL_SENDER        =
*     OUTPUT_OPTIONS     =
*     USER_SETTINGS      = 'X'
    IMPORTING
*     DOCUMENT_OUTPUT_INFO       =
      job_output_info    = ls_job_output
*     JOB_OUTPUT_OPTIONS =
    TABLES
      t_vbap             = lt_vbap
    EXCEPTIONS
      formatting_error   = 1
      internal_error     = 2
      send_error         = 3
      user_canceled      = 4
      OTHERS             = 5.
  IF sy-subrc <> 0.
* Implement suitable error handling here
  ENDIF.

  DATA lt_docs TYPE TABLE OF docs.
  DATA lt_lines_pdf TYPE TABLE OF tline.

  CALL FUNCTION 'CONVERT_OTF_2_PDF'
*  EXPORTING
*    use_otf_mc_cmd         = 'X'
*    archive_index          =                  " Archive index
*  IMPORTING
*    bin_filesize           =
    TABLES
      otf                    = ls_job_output-otfdata
      doctab_archive         = lt_docs
      lines                  = lt_lines_pdf            " Output table with target format
    EXCEPTIONS
      err_conv_not_possible  = 1                " Conversion not possible/supported
      err_otf_mc_noendmarker = 2
      OTHERS                 = 3.
  IF sy-subrc <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*   WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

  DATA(lv_string) = 'C:\Users\PavanUR\OneDrive - Ladera Technology Private Limited\Desktop\Report_Programs\Smartforms_Download\smartforms'.
*  DATA(lv_string) = 'C:\USERS\PAVANUR\DOWNLOADS\SMART\FORMS'.
  DATA(lv_filename) = |{ lv_string }{ sy-datum }{ sy-uzeit }.PDF |.

  CALL FUNCTION 'GUI_DOWNLOAD'
    EXPORTING
*     bin_filesize            =                      " File length for binary files
      filename                = lv_filename       " Name of file
      filetype                = 'BIN'                " File Type (ASC or BIN)
*     append                  = space                " Writing mode (overwrite, append)
*     write_field_separator   = space                " Separate Columns by Tabs in Case of ASCII Download
*     header                  = '00'                 " Byte Chain Written in Binary Mode at the Start of the File
*     trunc_trailing_blanks   = space                " Do not Write Blank at the End of Char Fields
*     write_lf                = 'X'                  " Insert CR/LF at End of Line in Case of Char Download
*     col_select              = space                " Copy Single Columns of the Table Only
*     col_select_mask         = space                " Vector Containing an 'X' for the Column To Be Copied
*     dat_mode                = space                " Numeric and Date Fields Written in ws_download 'DAT' Format
*     confirm_overwrite       = space                " Overwrite File Only After Confirmation
*     no_auth_check           = space                " Switch off Check for Access Rights
*     codepage                =                      " Character Representation for Output
*     ignore_cerr             = abap_true            " Specifies whether to ignore errors converting character sets
*     replacement             = '#'                  " Replacement Character for Non-Convertible Characters
*     write_bom               = space                " If set, writes a Unicode byte order mark
*     trunc_trailing_blanks_eol = 'X'                  " Removes spaces at end of last column
*     wk1_n_format            = space                " Format for value columns in files of the type WK1
*     wk1_n_size              = space                " Column width for value columns in files of the type WK1
*     wk1_t_format            = space                " Format for text columns for files of the type WK1
*     wk1_t_size              = space                " Column width for text columns for files of the type WK1
*     write_lf_after_last_line  = abap_true            " Writes LF even after last line
*     show_transfer_status    = abap_true
*     virus_scan_profile      = '/SCET/GUI_DOWNLOAD' " Virus Scan Profile
*  IMPORTING
*     filelength              =                      " Number of bytes transferred
    TABLES
      data_tab                = lt_lines_pdf                " Transfer table
*     fieldnames              =                      " Field Names for the 'DBF' File Type
    EXCEPTIONS
      file_write_error        = 1                    " Cannot write to file
      no_batch                = 2                    " Front-End Function Cannot Be Executed in Background
      gui_refuse_filetransfer = 3                    " Incorrect Front End
      invalid_type            = 4                    " Invalid value for parameter FILETYPE
      no_authority            = 5                    " No Download Authorization
      unknown_error           = 6
      header_not_allowed      = 7                    " Invalid header
      separator_not_allowed   = 8                    " Invalid separator
      filesize_not_allowed    = 9                    " Invalid file size
      header_too_long         = 10                   " The header information is limited to 1023 bytes at present
      dp_error_create         = 11                   " Cannot Create Data Provider
      dp_error_send           = 12                   " Error Sending Data with DataProvider
      dp_error_write          = 13                   " Error Writing Data with DataProvider
      unknown_dp_error        = 14                   " Error when calling data provider
      access_denied           = 15                   " Access to File Denied
      dp_out_of_memory        = 16                   " Not Enough Memory in DataProvider
      disk_full               = 17                   " Storage Medium Full
      dp_timeout              = 18                   " Timeout of DataProvider
      file_not_found          = 19                   " Could not find file
      dataprovider_exception  = 20                   " General Exception Error in Data Provider
      control_flush_error     = 21                   " Error in Control Framework
      OTHERS                  = 22.
  IF sy-subrc <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*   WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.



































*DATA: lc_fm_name      TYPE rs38l_fnam,
*
*      ls_control_par  TYPE ssfctrlop,
*
*      ls_job_output   TYPE ssfcrescl,
*
*      lc_file         TYPE string,
*
*      lt_lines        TYPE TABLE OF tline,
*
*      li_pdf_fsize    TYPE i,
*
*      ls_pdf_string_x TYPE xstring,
*
*      ls_pdf          TYPE char80,
*
*      lt_pdf          TYPE TABLE OF char80.
*
*" Get smartform function module name
*
*CALL FUNCTION 'SSF_FUNCTION_MODULE_NAME'
*  EXPORTING
*    formname           = 'ZDEMO_SMART_FORM_641'  " <- Set your smartform name
*  IMPORTING
*    fm_name            = lc_fm_name
*  EXCEPTIONS
*    no_form            = 1
*    no_function_module = 2
*    OTHERS             = 3.
*
*ls_control_par-no_dialog = 'X'.  " No dialog window
*
*ls_control_par-getotf    = 'X'.  " Get otf data
*
*ls_control_par-langu     = sy-langu.
*
*" Call smartform FM
*
*" NOTE: You have to add your custom SF parameters in this call
*
*CALL FUNCTION lc_fm_name
*  EXPORTING
*    control_parameters = ls_control_par
*  IMPORTING
*    job_output_info    = ls_job_output
*  EXCEPTIONS
*    formatting_error   = 1
*    internal_error     = 2
*    send_error         = 3
*    user_canceled      = 4
*    OTHERS             = 5.
*
*" Convert smartform OTF to PDF
*
*CALL FUNCTION 'CONVERT_OTF'
*  EXPORTING
*    format                = 'PDF'
*  IMPORTING
*    bin_filesize          = li_pdf_fsize
*    bin_file              = ls_pdf_string_x
*  TABLES
*    otf                   = ls_job_output-otfdata
*    lines                 = lt_lines
*  EXCEPTIONS
*    err_max_linewidth     = 1
*    err_format            = 2
*    err_conv_not_possible = 3
*    err_bad_otf           = 4
*    OTHERS                = 5.
*
*" Convert xstring to binary
*
*CALL FUNCTION 'SCMS_XSTRING_TO_BINARY'
*  EXPORTING
*    buffer     = ls_pdf_string_x
*  TABLES
*    binary_tab = lt_pdf.
*
*lc_file = 'dir/sfname.pdf'.
*
*" Save file using dataset, can be done with gui_services too
*
*OPEN DATASET lc_file FOR OUTPUT IN BINARY MODE.
*
*IF sy-subrc IS INITIAL.
*
*  LOOP AT lt_pdf INTO ls_pdf.
*
*    TRANSFER ls_pdf TO lc_file
*
*      NO END OF LINE.
*
*  ENDLOOP.
*
*  CLOSE DATASET lc_file.
*
*ENDIF.
